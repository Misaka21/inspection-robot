![...](..\..\TCP-IP%20API\机器人导航API\images\路径导航.001.png)

**路径导航**

```路径导航为给定目标站点, 由机器人自动规划路径运行, 期间会经过其它中间站点但不会停留。```


```<p>注意：</p><p>1. 这个接口只用于任务链、验证测试等单车场景。不能用在调度场景。在调度场景下会出现速度不连续、不跟随路径等危险情况。</p><p>2. 如果当前任务没有完成，用此 API 下发新的导航任务后，当前任务就会被取消，立刻执行新下发的任务。</p><p>3. 此 API 非强制 task\_id 字段。</p><p>4. task\_id 不能重复。</p><p>5. 如果想实现，追加导航任务的功能，可以用指定路径导航的 API。</p><p>6. 此 API 下发有效任务后，机器人会自动清除以下报错码:</p><p>warning 等级：</p><p>[54901 ](https://seer-group.feishu.cn/wiki/U5njwGnP1io8ZPkIWCScVkEhn3e), [54231 ](https://seer-group.feishu.cn/wiki/GTYZwwuYTiZLOOknAlrcZwD3nQX), [54027 ](https://seer-group.feishu.cn/wiki/S21tw6S14iHtmwkZQL8cOKBtn5w), 54208, [54028 ](https://seer-group.feishu.cn/wiki/S21tw6S14iHtmwkZQL8cOKBtn5w), [54070 ](https://seer-group.feishu.cn/wiki/S21tw6S14iHtmwkZQL8cOKBtn5w), [55300 ](https://seer-group.feishu.cn/wiki/MKdAwO83vi0Kg3kruVrcL3Ben3e), [54313](https://seer-group.feishu.cn/wiki/Zb6wwMGO0iBccOke2t5cM83hnOg)</p><p>error 等级：</p><p>[53000 ](https://seer-group.feishu.cn/wiki/MKdAwO83vi0Kg3kruVrcL3Ben3e), [52114 ](https://seer-group.feishu.cn/wiki/S21tw6S14iHtmwkZQL8cOKBtn5w), [52115 ](https://seer-group.feishu.cn/wiki/S21tw6S14iHtmwkZQL8cOKBtn5w), [52200 ](https://seer-group.feishu.cn/wiki/S21tw6S14iHtmwkZQL8cOKBtn5w), [52201 ](https://seer-group.feishu.cn/wiki/S21tw6S14iHtmwkZQL8cOKBtn5w), [52202 ](https://seer-group.feishu.cn/wiki/S21tw6S14iHtmwkZQL8cOKBtn5w), [52203 ](https://seer-group.feishu.cn/wiki/S21tw6S14iHtmwkZQL8cOKBtn5w), [52204 ](https://seer-group.feishu.cn/wiki/S21tw6S14iHtmwkZQL8cOKBtn5w), [52300 ](https://seer-group.feishu.cn/wiki/S21tw6S14iHtmwkZQL8cOKBtn5w), [52400 ](https://seer-group.feishu.cn/wiki/S21tw6S14iHtmwkZQL8cOKBtn5w), [52600 ](https://seer-group.feishu.cn/wiki/S21tw6S14iHtmwkZQL8cOKBtn5w), [52700 ](https://seer-group.feishu.cn/wiki/S21tw6S14iHtmwkZQL8cOKBtn5w), [52701 ](https://seer-group.feishu.cn/wiki/S21tw6S14iHtmwkZQL8cOKBtn5w), [52702 ](https://seer-group.feishu.cn/wiki/S21tw6S14iHtmwkZQL8cOKBtn5w), [52703 ](https://seer-group.feishu.cn/wiki/S21tw6S14iHtmwkZQL8cOKBtn5w), [52704 ](https://seer-group.feishu.cn/wiki/S21tw6S14iHtmwkZQL8cOKBtn5w), [52705 ](https://seer-group.feishu.cn/wiki/S21tw6S14iHtmwkZQL8cOKBtn5w), [52706 ](https://seer-group.feishu.cn/wiki/S21tw6S14iHtmwkZQL8cOKBtn5w), [52708 ](https://seer-group.feishu.cn/wiki/S21tw6S14iHtmwkZQL8cOKBtn5w), [52710 ](https://seer-group.feishu.cn/wiki/S21tw6S14iHtmwkZQL8cOKBtn5w), [52713 ](https://seer-group.feishu.cn/wiki/S21tw6S14iHtmwkZQL8cOKBtn5w), [52714 ](https://seer-group.feishu.cn/wiki/S21tw6S14iHtmwkZQL8cOKBtn5w), [52715 ](https://seer-group.feishu.cn/wiki/S21tw6S14iHtmwkZQL8cOKBtn5w), [52800 ](https://seer-group.feishu.cn/wiki/S21tw6S14iHtmwkZQL8cOKBtn5w), [52803 ](https://seer-group.feishu.cn/wiki/Lz2gwToeFilK8Lkh4K1cWXnhnqg), [52950 ](https://seer-group.feishu.cn/wiki/S21tw6S14iHtmwkZQL8cOKBtn5w), [52951 ](https://seer-group.feishu.cn/wiki/S21tw6S14iHtmwkZQL8cOKBtn5w), [52952 ](https://seer-group.feishu.cn/wiki/S21tw6S14iHtmwkZQL8cOKBtn5w), [52309 ](https://seer-group.feishu.cn/wiki/S21tw6S14iHtmwkZQL8cOKBtn5w), [52801 ](https://seer-group.feishu.cn/wiki/S21tw6S14iHtmwkZQL8cOKBtn5w), [52161 ](https://seer-group.feishu.cn/wiki/S21tw6S14iHtmwkZQL8cOKBtn5w), [52162 ](https://seer-group.feishu.cn/wiki/S21tw6S14iHtmwkZQL8cOKBtn5w), [52168 ](https://seer-group.feishu.cn/wiki/S21tw6S14iHtmwkZQL8cOKBtn5w), [52179 ](https://seer-group.feishu.cn/wiki/K5jDwgrRrinaWek0qlrcMHtwnuc), [52961 ](https://seer-group.feishu.cn/wiki/S21tw6S14iHtmwkZQL8cOKBtn5w), [52164 ](https://seer-group.feishu.cn/wiki/S21tw6S14iHtmwkZQL8cOKBtn5w), [52165 ](https://seer-group.feishu.cn/wiki/S21tw6S14iHtmwkZQL8cOKBtn5w), [52166 ](https://seer-group.feishu.cn/wiki/S21tw6S14iHtmwkZQL8cOKBtn5w), [52167 ](https://seer-group.feishu.cn/wiki/S21tw6S14iHtmwkZQL8cOKBtn5w), [52963 ](https://seer-group.feishu.cn/wiki/S21tw6S14iHtmwkZQL8cOKBtn5w), [52716 ](https://seer-group.feishu.cn/wiki/S21tw6S14iHtmwkZQL8cOKBtn5w), [52717 ](https://seer-group.feishu.cn/wiki/S21tw6S14iHtmwkZQL8cOKBtn5w), [52803 ](https://seer-group.feishu.cn/wiki/Lz2gwToeFilK8Lkh4K1cWXnhnqg), [52804 ](https://seer-group.feishu.cn/wiki/LYXhwQSLUiQ0q1k4Jn5celwUnee), [52805 ](https://seer-group.feishu.cn/wiki/MRCHwmA4UiaTV9kkRBPcPuhLnvf), 52032, 52044, [52313 ](https://seer-group.feishu.cn/wiki/Zb6wwMGO0iBccOke2t5cM83hnOg)</p>```
**请求**

- 编号: 3051 (0x0BEB)
- 名称: robot\_task\_gotarget\_req
- 描述: 路径导航
- JSON 数据区: 见下表

**注意事项：通常这个api需要配合[查询机器人导航状态](..\机器人状态API\查询机器人导航状态.md)，来查询当前机器人到点状态**

**1.纯固定路径导航**


```JSON
// 例子1.1 机器人沿着LM2->LM1的线路去往LM1
{
  "source\_id": "LM2",
  "id": "LM1"
}```

高级路径导航，支持用户自定义可选属性。比如支持配置最大速度，最大加速度，到点角度等参数。一个完整的固定路径导航指令如例子 1.2.

```JSON
// 例子1.2. 完整的路径导航指令
{
  "source\_id": "LM2",
  "id": "LM1",
  "angle": 1.57,
  "method": "backward",
  "max\_speed": 0.2,
  "max\_wspeed": 0.2,
  "max\_acc": 0.1,
  "max\_wacc": 0.1,
  "duration": 100,
  "orientation": 90,
  "spin": true
}```

表1.1 纯路径导航指令的含义

```字段名|类型|描述|可缺省``` :- | :- | :- |
|<p>id</p><p></p>|<p>string</p><p></p>|目标站点名称<br>当机器人在原地执行operation时，其固定值为 "SELF\_POSITION"|否|
|<p>source\_id</p><p></p>|<p>string</p><p></p>|起始站点名称<br>当起始位置不在一个站点上，而是机器人当前位置时，其值固定为"SELF\_POSITION"|否|
|task\_id|string|任务编号|是|
|angle|number|目标站点(世界坐标系)的角度值, 单位 rad|是|
|<p>method</p><p></p>|<p>string</p><p></p>|运动方式，只能为 "forward"(正走) 或 "backward"(倒走)，如果缺省则使用路径上配置的方式|是|
|max\_speed|number|最大速度, 单位 m/s|是|
|max\_wspeed|number|最大角速度, 单位 rad/s|是|
|max\_acc|number|最大加速度, 单位 m/s^2|是|
|max\_wacc|number|最大角加速度, 单位 rad/s^2|是|
|duration|number|导航结束后，机器人等待时间，单位 ms|是|
|orientation|number|全向车保持的角度（暂不使用）|是|
|spin|boolean|是否随动|是|
|delay|number|延迟结束导航状态的时间，单位 ms，缺省为 0|是|
|<p>start\_rot\_dir</p><p>(>=3.4.6.1802)</p>|<p>number</p><p></p>|起步原地旋转方向<br>-1: 顺时针转<br>0: 朝近的方向旋转<br>1: 逆时针转|是|
|<p>end\_rot\_dir</p><p></p><p>(>=3.4.6.1802)</p>|number|到点原地旋转方向<br>-1: 顺时针转<br>0: 朝近的方向旋转<br>1: 逆时针转|是|
|reach\_dist|number|到点位置精度 单位 m||
|reach\_angle|number|到点角度精度 单位 rad||
|skill\_name|string|"Action"表达在当前点作动作，或者“GotoSpecifiedPose”表示路径导航|是|

**2. 固定路径导航PGV二次定位调整**

机器人在到达终点后，支持依据地面或者货架上的二维码进行位置二次调整。

```JSON
// 例子2.1. 机器人从LM2到AP1，采用上视pgv进行位置二次调整
{
  "id": "AP1",
  "source\_id": "LM2",
  "task\_id": "123456",
  "use\_pgv": true,              //采用上视PGV进行调整
  "pgv\_adjustuse\_pgv\_dist": 0.3,       //最大的调整半径
  "pgv\_adjust\_cx": -0.3,        //调整范围的圆心偏移量
  "pgv\_adjust\_cy": 0
}```

表2.1 路径导航依据二维码二次调整指令的含义

```**字段名**|**类型**|**描述**|**可缺省**``` :- | :- | :- |
|<p>use\_pgv</p><p></p>|<p>bool</p><p></p>|是否采用上视pgv识别二维码进行位置的二次调整|是，默认为false|
|pgv\_adjust\_dist|number|二次调整的范围的最大半径，（用于第3，4种调整方式）|是|
|pgv\_adjust\_cx|number|二次调整范围中心x在二维码坐标系(这个坐标系与当前机器人坐标系平行）下的位置，（用于第4种调整方式）|是|
|pgv\_ajdust\_cy|number|二次调整范围中心y在二维码坐标系(这个坐标系与当前机器人坐标系平行）下的位置，（用于第4种调整方式）|是|
|pgv\_x\_adjust|number|在 PGV 调整模式下，只对小车x方向的误差进行调整，（用于第2种调整方式）|是|
|use\_down\_pgv|bool|是否采用下视pgv识别二维码进行位置的二次调整|是|


**3. 固定路径导航带有 operation**

机器人支持顶升设备，货叉设备，托盘设备和牵引设备的控制

**3.1 顶升设备**

机器人可以通过识别的方式将货物顶起，或者将货物放下。

```JSON
// 例子3.1.1.机器人通过识别货架到达AP1，接着通过货架上的二维码进行二次定位，然后再将货物顶起来。
{
  "id": "AP1",
  "source\_id": "LM2",
  "task\_id": "12344321",
  "operation": "JackLoad",
  "jack\_height": 0.04,
  "recognize": true,
  "use\_pgv": true
}```


```JSON
// 例子3.1.2 机器人到达AP1，接着通过下视pgv进行位置的二次调整，然后货物放下
{
  "id": "AP1",
  "source\_id": "LM2",
  "task\_id": "12344321",
  "operation": "JackUnload",
  "use\_down\_pgv": true
}```


```JSON
// 例子3.1.3.机器人到达AP1，将顶升设备上升到0.2m的高度
{
  "id": "AP1",
  "source\_id": "LM2",
  "task\_id": "12344321",
  "operation": "JackHeight",
  "jack\_height": 0.2
}```

表3.1. 路径导航带有顶升设备

```字段名|类型|描述|可缺省``` :- | :- | :- |
|<p>operation</p><p></p>|<p>string</p><p></p>|控制顶升设备的动作，支持的动作<br>JackLoad（顶升抬起加载货物，会将机器人设置为载货状态）<br>JackUnload(顶升下降，卸载货物，会将机器人取消载货状态)<br>JackHeight(顶升顶高)<br>Wait(不做动作)|<p>是，默认为Wait</p><p></p>|
|<p>jack\_height</p><p></p>|number|顶升的高度，如果JackLoad和JackUnload时，采用此数值作为顶升目标高度|是|

**3.2 货叉设备**

机器人（叉车或者地牛）可以通过识别的方式将栈板抬起来，或者放下。

```JSON
// 例子3.2.1 .机器人将货叉移动到start\_height高度，接着通过识别栈板确定目标点位置，再接着机器人移动到目标点，然后机器人将货架抬起来，加载货物
{
  "id": "AP1",
  "source\_id": "LM2",
  "task\_id": "12344321",
  "operation": "ForkLoad",
  "start\_height": 0.1,
  "end\_height": 1.0,
  "recognize": true
}```


```JSON
// 例子3.2.2.机器人将货叉移动到start\_height高度，接着机器人移动到目标点，然后机器人将货叉放下，卸载货物
{
  "id": "AP1",
  "source\_id": "LM2",
  "task\_id": "12344321",
  "operation": "ForkUnload",
  "start\_height": 0.5,
  "end\_height": 0.1
}```


```JSON
// 例子3.2.3.机器人去往AP1点的途中将货叉上升到0.5m的高度
{
  "id": "AP1",
  "source\_id": "LM2",
  "task\_id": "12344321",
  "operation": "ForkHeight",
  "fork\_mid\_height": 0.5
}```


```JSON
// 例子3.2.4.机器人去往AP1后将货叉上升到0.1m的高度
{
  "id": "AP1",
  "source\_id": "LM2",
  "task\_id": "12344321",
  "operation": "ForkHeight",
  "end\_height": 0.1
}```


```JSON
// 例子3.2.5.机器人去往AP1后将货叉前移到0.1m
{
  "id": "AP1",
  "source\_id": "LM2",
  "task\_id": "12344321",
  "operation": "ForkForward",
  "fork\_dist": 0.1
}```


```JSON
// 例子3.2.6 .机器人将货叉移动到start\_height高度，接着通过（shelf/s0002.shelf）识别栈板确定目标点位置
{
  "id": "AP1",
  "source\_id": "LM2",
  "task\_id": "12344321",
  "operation": "ForkLoad",
  "start\_height": 0.1,
  "end\_height": 1.0,
  "recognize": true,
  "recfile":"shelf/s0002.shelf"
}```

表 3.2 路径导航带有货叉设备

```字段名|类型|描述|可缺省``` :- | :- | :- |
|<p>operation</p><p></p>|string|控制货叉设备的动作，支持的动作<br>ForkLoad（货叉加载货物，会将叉车状态变成载货中）<br>ForkUnload(货叉卸载货物，会将叉车的状态变成非载货中)<br>ForkHeight(货叉顶高)<br>ForkForward(货叉前移）<br>Wait(不做动作)|是，默认为Wait|
|start\_height|number|货叉起步前的举升高度|是|
|fork\_mid\_height|number|货叉行走过程中的举升高度|是|
|end\_height|number|货叉到点后的举升高度|是|
|fork\_dist|number|前移式货叉，前移距离|是|

**3.3 辊筒设备**

机器人支持单辊筒设备的控制

```JSON
// 例子3.3.1，机器人通过滚筒在左侧加载货物
{
  "id": "AP1",
  "source\_id": "LM2",
  "task\_id": "12345",
  "operation": "RollerLoad",
  "direction ": "left"
}```


```JSON
// 例子3.3.2，机器人通过滚筒在右侧卸载货物
{
  "id": "AP1",
  "source\_id": "LM2",
  "task\_id": "12345",
  "operation": "RollerUnload",
  "direction": "right"
}```

表3.3. 路径导航带有辊筒设备

```字段名|类型|描述|可缺省``` :- | :- | :- |
|operation|string|<p>控制辊筒设备的动作，支持的动作<br>RollerLoad（辊筒加载货物）</p><p>RollerUnload（辊筒卸载货物）<br>RollerRoll (辊筒转动, 对应的direction 只有 left和right)<br>RollerPreLoad (辊筒预加载货物)<br>RollerStop (辊筒停止）<br>RollerPass（向左/右通过。2挡板均放，通过后辊筒停止转动，挡板不升起,，对应direction只有 left和right）<br>RollerInverse（设置辊筒转动方向对换）<br>RollerInverseReset（把辊筒设置为默认转动方向）</p><p>Wait（不做动作）</p>|是，默认为Wait|
|<p>direction</p><p></p>|string|left（左）,<br>right（右）,<br>front（前）,<br>back（后）|是|

**3.4 牵引设备**

机器人支持牵引设备

```JSON
// 例子3.4.1， 机器人通过识别将货物牵引
{
  "id": "AP1",
  "operation": "HookLoad",
  "source\_id": "LM2",
  "task\_id": "12345",
  "recognize": true
}```


```JSON
// 例子3.4.2， 机器人将牵引的货物放下
{
  "id": "AP1",
  "operation": "HookUnload",
  "source\_id": "LM2",
  "task\_id": "12345"
}```

表3.4. 路径导航带有牵引设备

```字段名|类型|描述|可缺省``` :- | :- | :- |
|operation|<p>string</p><p></p>|控制牵引设备的动作，支持的动作<br>HookLoad（牵引货物）<br>HookUnload (卸载货物)<br>Wait（不做动作）|是，默认为Wait|

**3.5 音频设备**


```JSON
// 例子3.5.1， 机器人到达AP1点后循环播放navigation音乐
{
  "id": "AP1",
  "operation": "sound",
  "source\_id": "LM2",
  "task\_id": "12345",
  "sounds\_args": {
    "name": "navigation",
    "loop": 1
  }
}```


```JSON
// 例子3.5.2， 机器人到达AP1点后停止音乐
{
  "id": "AP1",
  "operation": "sound",
  "source\_id": "LM2",
  "task\_id": "12345",
  "sounds\_args": {
    "stop": 1
  }
}```


```JSON
{
  "id": "SELF\_POSITION",
  "operation": "sound",
  "sounds\_args": {
    "name": "navigation",
    "loop": 1
  }
}```

表3.5 sound\_args 参数的说明

```字段名|类型|描述|可缺省``` :- | :- | :- |
|name|string|音频名称|是，默认为空|
|loop|int|0:只播放一次<br>1:表示循环播放|是，默认0|
|stop|int|0：表示不处理<br>1：表示关闭|是，默认0|

**3.6 等待DI触发**

例子3.5.1， 机器人到达 AP1 点后,机器人在原地等待 DI1 变为 true，DI2 变为 false，或者等待 10s 后则任务完成。

```JSON
// 注意：RBK3.3.5.58 - 3.3.5.62 不兼容此格式！
{
  "id": "AP1",
  "operation": "WaitDI",
  "source\_id": "LM2",
  "task\_id": "12345",
  "args": {
    "DI": [
            {
                "id": 1,
                "status": true
            },
            {
                "id": 2,
                "status": false
            }
      ],
      "timeout": 10
  }
}```
或者

```JSON
{
  "id": "AP1",
  "operation": "WaitDI",
  "source\_id": "LM2",
  "task\_id": "12345",
  "1": true,
  "2": false,
  "args": {"timeout": 10}
}```

表3.5 WaitDI 参数的说明

```字段名|类型|描述|可缺省``` :- | :- | :- |
|DI|object|DI的json object包含id和status|否|
|timeout|double|任务完成的超时时间 s|是|

**3.7 控制DO开关**

例子3.7.1 展示了机器人到达 AP1 后，执行控制 DO 状态，传入参数表示机器人打开 DO1，关闭 DO2

```JSON
{
  "id": "AP1",
  "operation": "SetDO",
  "source\_id": "LM2",
  "task\_id": "12345",
  "args": {
    "DO": [
      {
        "id": 1,
        "status": true
      },
      {
        "id": 2,
        "status": false
      }
    ]
  }
}```

或者，不过这种方式不推荐

```JSON
{
  "id": "AP1",
  "operation": "SetDO",
  "source\_id": "LM2",
  "task\_id": "12345",
  "1": true,
  "2": false
}```

表3.7.1 SetDO参数的说明

```字段名|类型|描述|可缺省``` :- | :- | :- |
|DO|object|DO的json object包含id和status|否|

**3.8 等待Triggle触发脚本动作**


```JSON
// 例子3.9.1 展示了机器人到达AP1后，等待Triggle触发，执行相应的脚本动作，如果执行完成，则任务完成
{
  "id": "AP1",
  "script\_name": "syspy/triggleScript.py",
  "script\_args": {},
  "operation":"Script",
  "source\_id": "LM2",
  "task\_id": "12345"
}```

**3.9 单个电机控制**

// TODO

**3.10 在二维码上调整**

控制机器人在二维码上，进行位置调整

```JSON
// 例子3.10.1 展示了在当前点按上视pgv进行调整
{
  "id": "SELF\_POSITION",
  "operation": "GoPGV",
  "source\_id": "SELF\_POSITION",
  "task\_id": "123",
  "use\_pgv": true,
  "use\_down\_pgv": false
}```


```JSON
// 例子3.10.2 展示了在当前点按下视pgv进行调整
{
  "id": "SELF\_POSITION",
  "operation": "GoPGV",
  "source\_id": "SELF\_POSITION",
  "task\_id": "1234",
  "use\_pgv": false,
  "use\_down\_pgv": true
}```

表3.10.1 调整 PGV 参数的说明

```字段名|类型|描述|可缺省``` :- | :- | :- |
|use\_pgv|bool|是否进行上视pgv调整|否|
|use\_down\_pgv|bool|是否进行下视pgv调整|否|


```注意如果use\_pgv和use\_down\_pgv,两个都为true，则按上视pgv进行调整```

**4.在原地执行 operation**

机器人的 operation 在导航的前中后期执行外，还可以原地执行。原地执行需要将 id 设置为 SELF\_POSITION , source\_id 设置为 SELF\_POSITION

```JSON
// 例子4.1 展示了在当前点执行JackLoad的operation
{
  "id": "SELF\_POSITION",
  "source\_id": "SELF\_POSITION",
  "task\_id": "12345678abcdefgh",
  "operation": "JackLoad"
}```


**5.固定路径执行脚本**

表5.0.0 固定路径执行脚本，脚本相关字段说明

```字段名|类型|描述|可缺省``` :- | :- | :- |
|operation|string|固定写 "Script"|否|
|script\_name|string|脚本名。实际为脚本相对路径，例如：<br>"syspy/goPath.py"|否|
|<p>script\_args</p><p></p>|<p>object</p><p></p>|脚本中实际定义的参数。例如：||

```JSON
{
  "x": 1.0,
  "y": 0.0,
  "coordinate":"robot"
}```

```|||根据脚本实际情况``` :- | :- | :- |

**5.1 通用脚本**

机器人可以在导航前，或者导航中，或者导航完成后执行脚本。

```JSON
// 例子5.1.1 展示了机器人去往LM1点\*\*后\*\*，执行脚本firstScript.py，脚本的传入参数为{"hello":"world"}.
{
  "script\_name": "firstScript.py",
  "script\_args": {
    "hello": "world"
  },
  "operation": "Script",
  "id": "LM1",
  "source\_id": "LM2",
  "task\_id": "12344321",
  "script\_stage": 2
}```


```JSON
// 例子5.1.2 展示了机器人去往LM1\*\*途中\*\*，执行脚本firstScript.py，脚本的传入参数为{"hello":"world"}.

{
  "script\_name": "firstScript.py",
  "script\_args": {
    "hello": "world"
  },
  "operation": "Script",
  "id": "LM1",
  "source\_id": "LM2",
  "task\_id": "12344321",
  "script\_stage": 1
}```


```JSON
// 例子5.1.3 展示了机器人去往LM1\*\*前\*\*，执行脚本firstScript.py，脚本的传入参数为{"hello":"world"}.
{
  "script\_name": "firstScript.py",
  "script\_args": {
    "hello": "world"
  },
  "operation": "Script",
  "id": "LM1",
  "source\_id": "LM2",
  "task\_id": "12344321",
  "script\_stage": 0
}```

表5.1.1 通用脚本描述说明

```字段名|类型|描述|可缺省``` :- | :- | :- |
|operation|string|"script"|否|
|script\_name|string|脚本文件名称(实际为脚本相对路径)|否|
|script\_args|object|脚本的输入参数，为JSON字符串|是|
|<p>script\_stage</p><p></p>|int|<p>0: 导航前执行脚本<br>1: 导航过程中执行脚本<br>2: 导航完成后执行的脚本</p><p>3: 脚本控制导航</p>|<p>是，默认为2</p><p></p>|

**5.2 内置脚本 goPath.py，按自定义路径导航**

goPath.py 用于给机器人下发一段世界坐标或者机器人坐标系下的路径。

```JSON
// 例子5.2.1 展示了机器人在当前位置，执行脚本goPath.py，脚本的传入参数表示机器人在自己坐标系下放前走 1m
{
  "script\_name": "syspy/goPath.py",
  "script\_args": {
    "x": 1.0,
    "y": 0.0,
    "coordinate": "robot"
  },
  "operation": "Script",
  "id": "SELF\_POSITION",
  "source\_id": "SELF\_POSITION",
  "task\_id": "12344321"
}```


```JSON
// 例子5.2.2 展示了机器人在当前位置，执行脚本goPath.py，脚本的传入参数表示机器人走到世界坐标系下x:1.0, y:0.0的位置
{
  "script\_name": "syspy/goPath.py",
  "script\_args": {
    "x": 1.0,
    "y": 0.0,
    "coordinate": "world"
  },
  "operation": "Script",
  "id": "SELF\_POSITION",
  "source\_id": "SELF\_POSITION",
  "task\_id": "12344321"
}```

表 5.2.1 goPath.py 输入参数的说明

```字段名|类型|描述|可缺省``` :- | :- | :- |
|x|double|x坐标，m|否|
|y|double|y坐标，|否|
|<p>coordinate</p><p></p>|string|"robot"机器人坐标系<br>"world"世界坐标系|否|
|<p>theta</p><p></p>|double|机器人角度，坐标系与 coordinate 的勾选内容对对应，rad|是|
|reachAngle|double|到点角度精度,rad|是|
|reachDist|double|到点位置精度,m|是|
|backMode|int|1：倒走<br>0：正走|是，默认0|
|useOdo|int|1： 采用里程行走<br>0： 采用定位行走|是，默认0|
|hold\_dir|double|全向车型的平移角度，°|是，默认999（不开启）|

**5.3 内置脚本 setDO.py，同时控制多个DO开关**

setDO.py 脚本用于同时控制多个 DO 的开关。

```JSON
// 例子5.3.1 展示了机器人在当前位置，执行脚本setDO.py，脚本的传入参数表示机器人打开DO1，关闭DO2
{
  "script\_name": "syspy/setDO.py",
  "script\_args": {
    "DO": [
      {
        "id": 1,
        "status": true
      },
      {
        "id": 2,
        "status": false
      }
    ]
  },
  "operation": "Script",
  "id": "SELF\_POSITION",
  "source\_id": "SELF\_POSITION",
  "task\_id": "12344321"
}```

表5.3.1 setDO.py输入参数的说明

```字段名|类型|描述|可缺省``` :- | :- | :- |
|DO|object|DO的json object包含id和status|否|

**5.4 内置脚本 waitDI.py**

waitDI.py 脚本用于让车等待某些 DI 达到某种状态，或者达到超时条件，则算完成任务。

```JSON
// 例子5.4.1 展示了机器人在当前位置，执行脚本waitDI.py，脚本的传入参数表示机器人播放wind音频，然后在原地等待DI1变为true，DI2变为false，或者等待10s后则任务完成，音频结束。
{
  "script\_name": "syspy/waitDI.py",
  "script\_args": {
    "DI": [
      {
        "id": 1,
        "status": true
      },
      {
        "id": 2,
        "status": false
      }
    ],
    "timeout": 10,
    "soundName": "wind"
  },
  "operation": "Script",
  "id": "SELF\_POSITION",
  "source\_id": "SELF\_POSITION",
  "task\_id": "12344321"
}```

表 5.4.1 waitDI.py 输入参数的说明

```字段名|类型|描述|可缺省``` :- | :- | :- |
|DI|object|DI的json object包含id和status|否|
|timeout|double|任务完成的超时时间 s|是|
|soundName|string|等待DI时，音频的名称|是|


**5.5 内置脚本 sound.py，控制音频设备**

sound.py 脚本用于控制音频的播放和停止。

```JSON
// 例子5.5.1 展示了机器人在当前位置，执行脚本sound.py，脚本的传入参数表示机器人开始循环播放navigation这个音频
{
  "script\_name": "syspy/sound.py",
  "script\_args": {
    "name": "navigation",
    "loop": 1
  },
  "operation": "Script",
  "id": "SELF\_POSITION",
  "source\_id": "SELF\_POSITION",
  "task\_id": "12344321"
}```


```JSON
// 例子5.5.2 展示了机器人在当前位置，执行脚本sound.py，脚本的传入参数表示机器人停止播放音频
{
  "script\_name": "syspy/sound.py",
  "script\_args": {
    "stop": 1
  },
  "operation": "Script",
  "id": "SELF\_POSITION",
  "source\_id": "SELF\_POSITION",
  "task\_id": "12344321"
}```

表 5.5.1 sound.py 输入参数的说明

```字段名|类型|描述|可缺省``` :- | :- | :- |
|name|string|音频名称|是，默认为空|
|loop|int|0:只播放一次<br>1:表示循环播放|是，默认0|
|stop|int|0：表示不处理<br>1：表示关闭|是，默认0|


**5.6 在当前点位切换地图并自动重定位（用于电梯和自动门地图切换）**


switchMap.py 脚本用于地图切换。

```JSON
// 例子5.6.1 展示了机器人在当前位置，执行脚本switchMap.py，脚本的传入参数表示机器人切换到mizhan的地图
{
  "script\_name": "syspy/switchMap.py",
  "script\_args": {
    "map": "mizhan"
  },
  "operation": "Script",
  "id": "SELF\_POSITION",
  "source\_id": "SELF\_POSITION",
  "task\_id": "12344321"
}```

表5.6.1 switchMap.py输入参数的说明

```字段名|类型|描述|可缺省``` :- | :- | :- |
|map|string|地图名称|否|

**6. 原地旋转**

控制机器人原地旋转 90° ，最大角速度为 90°/s。旋转过的角度是基于激光定位。而不是基于里程定位。

```JSON
{
    "move\_angle": 1.57,
    "skill\_name": "GoByOdometer",
    "speed\_w": 1.57,
    "loc\_mode": 1
}```
表.6.2 输入参数说明

```字段名|类型|描述|可缺省``` :- | :- | :- |
|move\_angle|double|旋转角度|否|
|speed\_w|double|角速度|否|
|skill\_name|string|任务类型，只能为 GoByOdometer|否|
|loc\_mode|<p>uint</p><p></p>|<p>定位模式。1 表示激光定位，0 或者其他 表示按里程定位。</p><p>默认值为 0</p>||

\7. **自由导航（仅支持双轮差速底盘模型）**

```JSON
{
  "freeGo": {
    "theta": 2.7610862764774287,
    "x": -8.619220466436861,
    "y": 2.9715085548101388
  },
  "id": "SELF\_POSITION"
}```


```字段名|类型|描述|可缺省``` :- | :- | :- |
|<p>freeGo</p><p></p>|<p>string</p><p></p>|<p>表示使用自由导航</p><p></p>|<p>否</p><p></p>|
|x|double|目标点坐标|否|
|y|double|目标点坐标|否|
|theta|double|目标点坐标|否|
示例：

![...](..\..\TCP-IP%20API\机器人导航API\images\路径导航.002.png)


**响应**

- 编号: 13051 (0x32FB)
- 名称: robot\_task\_gotarget\_res
- 描述: 路径导航的响应
- JSON 数据区: 见下表

```字段名|类型|描述|可缺省``` :- | :- | :- |
|ret\_code|number|API 错误码|是|
|create\_on|string|API 上传时间戳|是|
|err\_msg|string|错误信息|是|

**响应示例**


```JSON
{
  "ret\_code": 0
}```


```Plaintext
5A 01 00 01 00 00 00 0E 32 FB 0B EB 00 00 00 00
7B 22 72 65 74 5F 63 6F 64 65 22 3A 30 7D```



