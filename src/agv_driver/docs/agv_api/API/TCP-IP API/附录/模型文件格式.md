![...](..\..\TCP-IP%20API\附录\images\模型文件格式.001.png)

**模型文件格式**

**简介**

.model 模型文件格式为我司自定义的文件类型，其本质为标准 JSON 格式的文本文件，肉眼是可读的。使用 VS Code 或 Sublime Text 之类的文本编辑软件打开即可看到具体的文件内容，示例如下：


```JSON
{"model":"AMB-150","deviceTypes":[{"ord":0,"name":"ChooseAGV","desc":"6YCJ6L2m5p2D5YC8","maxCount":1,"devices":[{"name":"ChooseAGV","desc":"6YCJ6L2m5p2D5YC8","isDisplay":true,"isEnabled":true,"deviceParams":[{"key":"basic","desc":"5Z+656GA5Y+C5pWw","type":"arrayParam","arrayParam":{"params":[{"key":"distRatio","type":"double","unit":"","desc":"6Led56a75p2D5YC8","cloneEnable":false,"doubleValue":1,"doubleMaxvalue":10000000,"doubleMinvalue":0.001},{"key":"priorityRatio","type":"double","unit":"","desc":"5LyY5YWI57qn5p2D5YC8","cloneEnable":false,"doubleValue":100000,"doubleMaxvalue":100000000,"doubleMinvalue":0.001},{"key":"waitTimeRatio","type":"double","unit":"","desc":"562J5b6F5pe26Ze05p2D5YC8","cloneEnable":false,"doubleValue":1,"doubleMaxvalue":100000000,"doubleMinvalue":0.001}]},"cloneEnable":false}]}]},{"ord":0,"name":"HttpPost","desc":"SFRUUOWbnuWMhQ==","maxCount":100,"devices":[{"name":"HttpPostTemplate","desc":"SFRUUOWbnuWMheaooeadvw==","isDisplay":true,"isEnabled":true,"deviceParams":[{"key":"request","desc":"6K+35rGC5Y+C5pWw","type":"arrayParam","arrayParam":{"params":[{"key":"ip","type":"string","unit":"","desc":"5pyN5Yqh5ZmoSVA=","cloneEnable":false,"stringValue":"127.0.0.1"},{"key":"port","type":"uint32","unit":"","desc":"5pyN5Yqh5Zmo56uv5Y+j","cloneEnable":false,"uint32Value":8787,"uint32Maxvalue":65535,"uint32Minvalue":1},{"key":"path","type":"string","unit":"","desc":"6K+35rGC6Lev5b6E","cloneEnable":false,"stringValue":"/echo"},{"key":"includedFields","type":"string","unit":"","desc":"5YyF5ZCr55qE5a2X5q61","cloneEnable":false,"stringValue":"[\"orderId\", \"orderState\", \"blockId\", \"blockState\", \"location\"]"},{"key":"additionalJSON","type":"json","unit":"","desc":"6ZmE5Yqg5a2X5q61","cloneEnable":false,"stringValue":"{\"type\":\"LOAD\"}"}]},"cloneEnable":false},{"key":"condition","desc":"5oiQ5Yqf5p2h5Lu2","type":"arrayParam","arrayParam":{"params":[{"key":"statusCode","type":"uint32","unit":"","desc":"SFRUUOeKtuaAgeeggQ==","cloneEnable":false,"uint32Value":0,"uint32Maxvalue":99999,"uint32Minvalue":0},{"key":"responseBody","type":"string","unit":"","desc":"","cloneEnable":false,"stringValue":"{\"msg\":\"success\", \"code\":1000}"}]},"cloneEnable":false},{"key":"retry","desc":"6YeN6K+V","type":"arrayParam","arrayParam":{"params":[{"key":"enabled","type":"bool","unit":"","desc":"5ZCv55So6YeN6K+V","cloneEnable":false,"boolValue":false},{"key":"interval","type":"uint32","unit":"s","desc":"6YeN6K+V6Ze06ZqU","cloneEnable":false,"uint32Value":1,"uint32Maxvalue":99999,"uint32Minvalue":1},{"key":"maxTimes","type":"uint32","unit":"","desc":"5pyA5aSn6YeN6K+V5qyh5pWw","cloneEnable":false,"uint32Value":0,"uint32Maxvalue":99999,"uint32Minvalue":0}]},"cloneEnable":false},{"key":"failure","desc":"5aSx6LSl5aSE55CG","type":"arrayParam","arrayParam":{"params":[{"key":"failBlock","type":"bool","unit":"","desc":"5aSx6LSl5pe25L2/QmxvY2vlpLHotKU=","cloneEnable":false,"boolValue":false}]},"cloneEnable":false}]}]},{"ord":0,"name":"JoinOrder","desc":"5ou85ZCI5Y2V","maxCount":1,"devices":[{"name":"JoinOrder","desc":"5ou85ZCI5Y2V","isDisplay":true,"isEnabled":true,"deviceParams":[{"key":"basic","desc":"5Z+656GA5Y+C5pWw","type":"arrayParam","arrayParam":{"params":[{"key":"smartTerminate","type":"bool","unit":"","desc":"5pm66IO95Y+W5raI5Yet5Y2V5Lu75YqhLCDkvJroh6rliqjlsIbljbjotKfnmoTotKfnianmlL7lm57lj5botKflj6M=","cloneEnable":false,"boolValue":false}]},"cloneEnable":false}]}]},{"ord":0,"name":"PathPlanning","desc":"6Lev5b6E6KeE5YiS","maxCount":1,"devices":[{"name":"PlanPlanning","desc":"6Lev5b6E6KeE5YiS","isDisplay":true,"isEnabled":true,"deviceParams":[{"key":"basic","desc":"5Z+656GA5Y+C5pWw","type":"arrayParam","arrayParam":{"params":[{"key":"angleFactor","type":"double","unit":"","desc":"6KeS5bqm57O75pWw","cloneEnable":false,"doubleValue":1,"doubleMaxvalue":10000,"doubleMinvalue":0},{"key":"curveFactor","type":"double","unit":"","desc":"5puy546H57O75pWw","cloneEnable":false,"doubleValue":0.01,"doubleMaxvalue":10000,"doubleMinvalue":0},{"key":"queueFactor","type":"double","unit":"","desc":"5o6S6Zif57O75pWw77yM6LaK5aSn5aaC5p6c5YmN5pa56L2m6LaK5aSa5Y+v6IO95Lya5o+Q5YmN57uV5byA","cloneEnable":false,"doubleValue":1,"doubleMaxvalue":10000,"doubleMinvalue":0},{"key":"slowDownFactor","type":"double","unit":"","desc":"5YeP6YCf57O75pWw77yM6LaK5aSn5aaC5p6c5YmN5pa56L2m5YeP6YCf5Y+v6IO95Lya5o+Q5YmN57uV5byA","cloneEnable":false,"doubleValue":1,"doubleMaxvalue":10000,"doubleMinvalue":0},{"key":"stopFactor","type":"double","unit":"","desc":"5YGc6L2m57O75pWw77yM6LaK5aSn5aaC5p6c5YmN5pa56L2m5YGc5LiL5p2l5Y+v6IO95Lya5o+Q5YmN57uV5byA","cloneEnable":false,"doubleValue":100,"doubleMaxvalue":10000,"doubleMinvalue":0}]},"cloneEnable":false}]}]},{"ord":0,"name":"charger","desc":"Y2hhcmdlcg==","maxCount":0,"devices":[{"name":"charger","desc":"Y2hhcmdlcg==","isDisplay":true,"isEnabled":false,"deviceParams":[{"key":"brand","desc":"YnJhbmQ=","type":"comboParam","comboParam":{"childKey":"src-800","childParams":[{"key":"src-800","desc":"c3JjLTgwMA==","params":[{"key":"ip","type":"ip","unit":"","desc":"c3JjIGNoYXJnZXIgc3BvdCBpcA==","cloneEnable":false,"stringValue":"192.168.1.1"}]}]},"cloneEnable":false}]}]},{"ord":0,"name":"proxy","desc":"cHJveHk=","maxCount":0,"devices":[{"name":"proxy","desc":"cHJveHk=","isDisplay":true,"isEnabled":true,"deviceParams":[{"key":"type","desc":"dHlwZQ==","type":"comboParam","comboParam":{"childKey":"modbusTcp","childParams":[{"key":"ModbusTCP","desc":"TW9kYnVzVENQ","params":[{"key":"ip","type":"string","unit":"","desc":"bW9kYnVzVGNwIGlw","cloneEnable":false,"stringValue":"127.0.0.1"},{"key":"port","type":"uint32","unit":"","desc":"bW9kYnVzVGNwIHBvcnQ=","cloneEnable":false,"uint32Value":503,"uint32Maxvalue":65535,"uint32Minvalue":1},{"key":"slaveId","type":"uint32","unit":"","desc":"bW9kYnVzVGNwIHNsYXZlSWQ=","cloneEnable":false,"uint32Value":1,"uint32Maxvalue":65535,"uint32Minvalue":1},{"key":"timeout","type":"uint32","unit":"","desc":"dGltZW91dCB0aW1l","cloneEnable":false,"uint32Value":120,"uint32Maxvalue":65535,"uint32Minvalue":1}]},{"key":"HTTP","desc":"SFRUUA==","params":[{"key":"baseurl","type":"string","unit":"","desc":"SFRUUCBiYXNlIHVybA==","cloneEnable":false,"stringValue":"http://example.com"}]},{"key":"Tcp","desc":"VGNw","params":[{"key":"ip","type":"string","unit":"","desc":"VGNwIGlw","cloneEnable":false,"stringValue":"127.0.0.1"},{"key":"port","type":"uint32","unit":"","desc":"VGNwIHBvcnQ=","cloneEnable":false,"uint32Value":504,"uint32Maxvalue":65535,"uint32Minvalue":1},{"key":"timeout","type":"uint32","unit":"","desc":"dGltZW91dCB0aW1l","cloneEnable":false,"uint32Value":120,"uint32Maxvalue":65535,"uint32Minvalue":1}]}]},"cloneEnable":false}]}]}]}```

该 JSON 格式的文件是用 Protobuf 生成的，即在程序中，模型文件是以 Protobuf 结枸体的形式存在的，仅在保存为文件时，才导出为 JSON 格式。对于用户想自己解析模型文件时，既可以使用Protobuf，也可以单纯的使用 JSON 库来直接解析模型文件。JSON 的具体信息请参阅 JSON 宫网 http://www.json.org/json-zh.html，网站中也列出了各种编程语言常用的 JSON 库。

**模型文件的 Protobuf 格式**

Protobuf3 请参阅 [Google 官方文档 ](https://developers.google.com/protocol-buffers/docs/proto3)。

**message\_model.proto**

**[message\_model.proto]**


```ProtoBuf
syntax = "proto3";
package rbk.protocol.model;

message Message\_Param { // 参数 （键 - 值 - 最大值 - 最小值 - 描述 - 单位）
  string key = 1;
  string type = 2; // "bytes","string","ip"; "bool"; "int32","uint32","int64","uint64","float","double"
  oneof oneof\_value {
    string string\_value = 3;
    bool bool\_value = 4;
    int32 int32\_value = 5;
    uint32 uint32\_value = 6;
    int64 int64\_value = 7;
    uint64 uint64\_value = 8;
    float float\_value = 9;
    double double\_value = 10;
    bytes bytes\_value = 11;
  }
  oneof oneof\_maxValue {
    int32 int32\_maxvalue = 12;
    uint32 uint32\_maxvalue = 13;
    int64 int64\_maxvalue = 14;
    uint64 uint64\_maxvalue = 15;
    float float\_maxvalue = 16;
    double double\_maxvalue = 17;

  }
  oneof oneof\_minValue {
    int32 int32\_minvalue = 18;
    uint32 uint32\_minvalue = 19;
    int64 int64\_minvalue = 20;
    uint64 uint64\_minvalue = 21;
    float float\_minvalue = 22;
    double double\_minvalue = 23;
  }
  string unit = 24; // 单位：deg ,rad,m,cm,mm...
  string desc = 25; // 描述(base64-方便中文显示)
  bool clone\_enable = 32; // 是否可以克隆
}

message Message\_ChildParam { // 选择框单个下拉选项
  string key = 1; // 键
  string desc = 2; // 描述 (base64-方便中文显示)
  repeated Message\_Param params = 11;
}

message Message\_ArrayParam { // 列表参数
  repeated Message\_Param params = 1; // 该列表下所有的参数列表
}

message Message\_ComboParam { // 下拉选择框参数
  string child\_key = 3; // 下拉框当前的默认值（下拉列表中被选中的key）
  repeated Message\_ChildParam child\_params = 11; // 下拉列表
}

message Message\_DeviceParam { // 设备参数
  string key = 1; // 参数key (方便对比差异化)
  string desc = 2;
  string type = 3; // 参数类型 (comboParam/arrayParam)
  oneof oneof\_deviceValue {
    Message\_ComboParam combo\_param = 4; // 下拉选择框式的数据
    Message\_ArrayParam array\_param = 5; // 列表式的数据
  }
  bool clone\_enable = 32; // 是否可以克隆
}

message Message\_Device { // 设备
  string name = 1; // 名称
  string desc = 2; // 描述 (base64-方便中文显示)
  bool is\_display = 3; // 是否以图形的形式显示到界面
  bool is\_enabled = 4; // 设备是否激活使用
  repeated Message\_DeviceParam device\_params = 11; // 该设备下的所有参数        
}

message Message\_DeviceType { // 设备类型
  uint32 ord = 1; // 用于界面图层显示顺序
  string name = 2; // 名称
  string desc = 3; // 描述 (base64-方便中文显示)
  uint32 maxCount = 4; // 设备最大数量 (缺省或=0表示不限制)
  repeated Message\_Device devices = 11; // 该设备类型下所有设备
}

message Message\_Model {
  string model = 1; // 模型文件名称
  repeated Message\_DeviceType device\_types = 11; // 所有设备类型
}```

**模型文件的 JSON 格式**

模型文件的 JSON 格式是从 Protobuf 格式转换而来，JSON 和 Protobuf 格式可以相互转换，转换
按照 Protobut3 的 [规则 ](https://developers.google.com/protocol-buffers/docs/proto3#json)。


```从 Protobuf 转为 JSON 后，key 将从下划线分隔变为小驼峰形式，如 device\_types 变为deviceTypes```

**声明**

由于模型文件为我司自定义的私有格式，未来可能有所更改，不保证 100% 的向下兼容


