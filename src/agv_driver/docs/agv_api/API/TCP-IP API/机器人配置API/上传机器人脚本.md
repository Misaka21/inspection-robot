![...](..\..\TCP-IP%20API\机器人配置API\images\上传机器人脚本.001.png)

**上传机器人脚本**

**请求**

- 编号: 4021 (0x0FB5)
- 名称: robot\_config\_uploadscript\_req
- 描述: 上传机器人脚本
- JSON 数据区: 见下表

```**字段名**|**类型**|**描述**|**可缺省**``` :- | :- | :- |
|type|string|机器人脚本的类型，“module”=机构脚本，“ genetic ”=通用脚本|否|
|relative\_path|string|脚本相对目录，与 [脚本查询 ](..\机器人状态API\查询机器人脚本列表.md)中的相同|否|
|script|string|python脚本字符串|否|

**请求示例**

```JSON
{
  "type": "module",
  "relative\_path": "helloWorld/template.py",
  "script": "# -\*- coding: utf-8 -\*-\n# @Date: 2023/01/01\n# @Author: zhong\n# @File: template.py\n# @Version: 1.0\n# @Project: 机构脚本模板示例\n# @Coding:\n# @Update:\n\nimport json\nimport time\n\nfrom rbkSim import SimModule\nfrom rbk import MoveStatus, BasicModule, ParamServer\nfrom robot import ModuleTool, MotorType, Motor, Robot\n\n# =======脚本输入参数=======\n\"\"\"\n####BEGIN DEFAULT ARGS####\n{\n \"operation\": {\n \"value\": \"opt1\",\n \"default\_value\":[\"opt1\", \"opt2\", \"opt3\", \"clear\", \"show\"],\n \"type\": \"complex\" \n },\n \"param1\":{\n \"value\": 0,\n \"type\": \"int\"\n }, \n \"param2\": {\n \"value\": 0.0,\n \"type\": \"float\"\n },\n \"param3\":{\n \"value\": \"\",\n \"tips\": \"json格式参数\",\n \"type\": \"json\"\n }\n}\n####END DEFAULT ARGS####\n\"\"\"\n\n\nclass Module(BasicModule):\n def \_\_init\_\_(self, r: SimModule, args):\n super(Module, self).\_\_init\_\_()\n p = ParamServer(\_\_file\_\_)\n self.timeout = p.loadParam(\"timeout\", type=\"int\", default=120, maxValue=300, minValue=0, unit=\"s\",\n comment=\" 运行超时时间\")\n self.init = True\n self.status = MoveStatus.NONE\n self.report\_info = dict()\n self.motor1 = Motor(r, MotorType.LINEAR\_MOTOR, \"lift\", -1)\n self.robot = Robot(r)\n self.opt = args.get(\"operation\", None)\n self.param1 = args.get(\"param1\", None)\n self.param2 = args.get(\"param2\", None)\n self.param3 = args.get(\"param3\", None)\n r.logInfo(f\"init args: {args}\")\n\n def run(self, r: SimModule, args):\n self.status = MoveStatus.RUNNING\n if self.init:\n self.init = False\n # =====参数初始化和参数检查=====\n pass\n # 超时判断\n if time.time() - self.start\_time > self.timeout:\n r.setError(f\"script running timeout\")\n\n # =====处理业务逻辑=====\n r.setNotice(f\"param2: {self.param2}\")\n if self.param2 is not None:\n ret = self.robot.lift(self.motor1, self.param2)\n if ret:\n self.status = MoveStatus.FINISHED\n\n # 下发电机速度\n r.publishSpeed()\n # 打印电机运行数据\n self.report\_info['motor\_info'] = self.robot.state\n\n # =====报错及清除=====\n if args.get(\"operation\", None) == \"clear\":\n self.clear(r)\n if args.get(\"operation\", None) == \"show\":\n self.show(r)\n\n # =====数据上报及日志打印=====\n self.report\_info['args'] = args\n self.report\_info['task\_status'] = self.status\n\n r.setInfo(json.dumps(self.report\_info))\n r.logInfo(json.dumps(self.report\_info))\n return self.status\n\n def cancel(self, r: SimModule):\n # =====处理任务取消时的业务=====\n r.setNotice(f\"cancel task\")\n self.status = MoveStatus.NONE\n\n def suspend(self, r: SimModule):\n # =====处理任务暂停时的业务=====\n r.setNotice(f\"suspend task\")\n self.status = MoveStatus.SUSPENDED\n\n def clear(self, r: SimModule):\n r.clearNotice(57300)\n r.clearWarning(55300)\n r.clearError(53000)\n # 延时处理\n if ModuleTool.delay(0.5):\n self.status = MoveStatus.FINISHED\n\n def show(self, r: SimModule):\n r.setError(\"show error\")\n r.setWarning(\"show warning\")\n r.setNotice(\"show notice\")\n self.status = MoveStatus.FINISHED\n\n\nif \_\_name\_\_ == '\_\_main\_\_': # 本地运行测试\n r1 = SimModule()\n args1 = {}\n m = Module(r1, args1)\n run\_counter = 0\n while m.status is not MoveStatus.FAILED and m.status is not MoveStatus.FINISHED:\n m.run(r1, args1)\n if run\_counter > 10:\n break\n else:\n run\_counter += 1"
}```

**响应**

- 编号: 14021 (0x36C5)
- 名称: robot\_config\_uploadscript\_res
- 描述: 上传机器人脚本的响应
- JSON 数据区: 见下

```**字段名**|**类型**|**描述**|**可缺省**``` :- | :- | :- |
|ret\_code|number|API 错误码|是|
|create\_on|string|API 上传时间戳|是|
|err\_msg|string|错误信息|是|

**响应示例**

```JSON
 {
   "create\_on": "2024-05-07T11:53:44.100+0800",
   "ret\_code": 0
 }```


